# CLI Outline for Azure AI DocGen

---

**Purpose**
- Quick commands to operate the system in interactive and batch modes. This assumes the proposed UI API and Tool API from the architecture pages.

**Prerequisites**
- API base URL available as `DOCS_API` (e.g., `http://localhost:5000`).
- For Tool API calls from local shell (not from agents), proper auth headers if enabled.

---
## Environment
```bash
export DOCS_API="http://localhost:5000"
export RUN_ID=""
```
---
## Interactive run lifecycle (UI API)
```bash
# 1) Start a run (interactive, strict)
curl -sS -X POST "$DOCS_API/api/runs" \
  -H 'Content-Type: application/json' \
  -d '{
    "review_mode": "interactive",
    "validation_strictness": "strict",
    "inputs": {
      "requirementsPath": "Docs/Extend/Plugin-External/docgen/inputs/plugin-requirements.json",
      "hostBundle": "Docs/Extend/Plugin-External/docgen/inputs/host/rootServer.zip",
      "referenceDocset": "Docs/Extend/Plugin-External/docgen/inputs/reference/MODULE-node-editor.zip"
    }
  }'

# Capture RUN_ID from response (jq recommended)
# RUN_ID=$(curl ... | jq -r .runId)

# 2) Poll run status
curl -sS "$DOCS_API/api/runs/$RUN_ID"

# 3) Approve current gate (when AwaitingApproval)
curl -sS -X POST "$DOCS_API/api/runs/$RUN_ID/approve"

# 4) Cancel run (optional)
curl -sS -X POST "$DOCS_API/api/runs/$RUN_ID/cancel"

# 5) Download final bundle zip
curl -L "$DOCS_API/api/runs/$RUN_ID/download" -o "docset-$RUN_ID.zip"
```
---
## Batch run (UI API)
```bash
curl -sS -X POST "$DOCS_API/api/runs" \
  -H 'Content-Type: application/json' \
  -d '{
    "review_mode": "batch",
    "validation_strictness": "strict",
    "inputs": {
      "requirementsPath": "Docs/Extend/Plugin-External/docgen/inputs/plugin-requirements.json",
      "hostBundle": "Docs/Extend/Plugin-External/docgen/inputs/host/rootServer.zip"
    }
  }'
```
---
## Tool API examples (deterministic plane)
```bash
# Write a text artifact
curl -sS -X POST "$DOCS_API/tool/artifacts/write-text" \
  -H 'Content-Type: application/json' \
  -d '{
    "runId": "'$RUN_ID'",
    "path": "core/example-01.md",
    "content": "# Example File\n\nContent generated by an agent."
  }'

# List artifacts
curl -sS "$DOCS_API/tool/artifacts/list?runId=$RUN_ID"

# Read a text artifact
curl -sS "$DOCS_API/tool/artifacts/read-text?runId=$RUN_ID&path=core/example-01.md"

# Validate links
curl -sS -X POST "$DOCS_API/tool/validate/links" \
  -H 'Content-Type: application/json' \
  -d '{ "runId": "'$RUN_ID'", "phase": 2 }'

# Bundle zip
curl -sS -X POST "$DOCS_API/tool/bundle/zip" \
  -H 'Content-Type: application/json' \
  -d '{ "runId": "'$RUN_ID'" }' -o "bundle-$RUN_ID.zip"
```
---
## Minimal .NET example (HttpClient)
```csharp
using System.Net.Http.Json;

var http = new HttpClient { BaseAddress = new Uri(Environment.GetEnvironmentVariable("DOCS_API")!) };

// Start a run
var start = new {
    review_mode = "interactive",
    validation_strictness = "strict",
    inputs = new {
        requirementsPath = "Docs/Extend/Plugin-External/docgen/inputs/plugin-requirements.json",
        hostBundle = "Docs/Extend/Plugin-External/docgen/inputs/host/rootServer.zip"
    }
};
var startResp = await http.PostAsJsonAsync("/api/runs", start);
var runInfo = await startResp.Content.ReadFromJsonAsync<dynamic>();
Console.WriteLine(runInfo);

// Approve gate (example)
var runId = (string)runInfo?.runId;
await http.PostAsync($"/api/runs/{runId}/approve", null);
```

---

## Notes
- Operation paths align with the endpoint matrix in `30-diagrams.md`.
- In production, use authentication headers (e.g., bearer tokens or managed identity) per `A4-security-identity.md`.
- For scripting, prefer idempotent retries around polling and approvals.

---

**Related**
- [30-diagrams.md](30-diagrams.md)
- [06-orchestration-engine.md](06-orchestration-engine.md)
- [11-artifacts-and-manifest.md](11-artifacts-and-manifest.md)
- [A4-security-identity.md](A4-security-identity.md)

---

**Back to index:**
- [root](root.md)
- [foundation](00-foundation-index.md)
- [architecture](10-architecture-index.md)
- [operations](20-operations-index.md)
- [appendix](39-appendix-index.md)

---